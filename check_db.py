#!/usr/bin/env python3
import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ backend
sys.path.append(os.path.join(os.path.dirname(__file__), 'backend'))

from database import engine, Base
from models.models import EmployeeStatusSchedule, Employee

async def check_database():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    try:
        print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
        
        # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã
        async with engine.begin() as conn:
            await conn.run_sync(Base.metadata.create_all)
        print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ employee_status_schedules
        async with engine.begin() as conn:
            result = await conn.execute("SELECT COUNT(*) FROM employee_status_schedules")
            count = result.scalar()
            print(f"‚úÖ –¢–∞–±–ª–∏—Ü–∞ employee_status_schedules —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∑–∞–ø–∏—Å–µ–π: {count}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
        async with engine.begin() as conn:
            result = await conn.execute("SELECT COUNT(*) FROM employees")
            count = result.scalar()
            print(f"‚úÖ –¢–∞–±–ª–∏—Ü–∞ employees —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∑–∞–ø–∏—Å–µ–π: {count}")
            
            if count > 0:
                result = await conn.execute("SELECT id, first_name, last_name FROM employees LIMIT 5")
                employees = result.fetchall()
                print("üìã –ü—Ä–∏–º–µ—Ä—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:")
                for emp in employees:
                    print(f"   ID: {emp[0]}, –ò–º—è: {emp[1]} {emp[2]}")
        
        print("üéâ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        print(f"üìã Traceback: {traceback.format_exc()}")

if __name__ == "__main__":
    asyncio.run(check_database()) 